El objetivo de esta práctica es comprender y probar el funcionamiento de los sniffers, los ataques[D]DoS, así como diversos temas relacionados con lo que hemos llamado la trilogía (“host discovery”, “port scanning” y “fingerprinting”). En las sesiones prácticas se propondrán posibles herramientas a utilizar.
a) Instale el ettercap y pruebe sus opciones básicas en línea de comando.

	Instalado con apt-get install ettercap
	para utilizar el gtk hay que instalar el ettercap-gtk, y para ejecutarlo debemos hacerlo desde la terminal de root

b) Capture paquetería de una sesión no segura.

	Instalamos wireshark cno sudo apt-get install wireshark, lo iniciamos y empezamos a esnifar de la interfaz eth1. Estaba haciendo un ping por esa interfaz y salian todos los paquetes en el wireshark

c) Capture un paquete TCP e identifique los principales campos de cabecera.

	Poniendo el filtro de TCP only en el wireshark podemos ver solo los paquetes de tcp y clicando en uno y mirando en Transmission Control Protocol aparecen los datos de la cabecera, Source port, destinatin port, sequence number, acknowledgement number, header length, flags, window size, checksum, y options

	Tambien vale tcpdump

d) Capture un paquete IPv6 e identifique los principales campos de cabecera.

	Se puede ver con wireshark mientras, por ejemplo, haces un ping6 a otra maquina. Se pueden identificar los campos: version, traffic class, flowlabel, payload lenght, next header, hop limit, source, destination
	
	Tambien vale tcpdump

e) Indique 3 servicios que transmiten información en claro y otros 3 cifrada.
	
	claro: http, ftp, rsyslog
	cifrado: https, ftps, ssh

f) Obtenga la relación de las direcciones MAC de los equipos de su segmento.

	Como root, con nmap -sP ya obtenemos las direcciones ip y mac de los hosts de la red

g) Obtenga la relación de las direcciones IPv6 de su segmento.

h) Mediante arpspoofing entre una máquina objetivo (víctima) y el router del laboratorio obtenga todas las URL HTTP visitadas por la 
víctima. Trate de visualizarlas directamente en su navegador.

i) Haga un MITM en IPv6 y visualice la paquetería.

j) Utilizando un filtro ettercap modifique las imágenes de las páginas http visitadas por una determinada máquina del laboratorio.

	http://www.irongeek.com/i.php?page=security/ettercapfilter

	Creamos un filtro con extension .filter
	compilamos con etterfilter ig.filter -o ig.ef
	ejecutamos con ettercap -T -q -F ig.ef -M ARP /10.10.102.170/ //

k) Utilizando el ettercap -gtk trate de capturar el password de una sesión https.

l) Pruebe alguna herramienta y técnica de detección del sniffing.
	
Una tecnica bastante basica seria mirar si la targeta de red esta en modo promiscuo, o controlar los paquetes que salen de tu maquina

m) Pruebe distintas técnicas de host discovey, port scanning y OS fingerprinting sobre las máquinas del laboratorio de prácticas.

	host discovery:
		nmap -sP 10.10.102.0/24 
		ettercap -G 
			Sniff>>Unified sniffing
			Hosts>>Scan for hosts
	port scanning
		nmap -sT 10.10.102.171 (escaneo TCP)
		nmap -sU 10.10.102.171 (escaneo UDP)
		nmap -A 10.10.102.171
	fingerprinting
		nmap -A 10.10.102.171
		nmap -O 10.10.102.171 (no va muy bien)

n) Realice alguna de las pruebas de port scanning del apartado anterior sobre IPv6. ¿Coinciden los servicios prestados por un sistema con los de IPv4?.

No todos, ¿por qué?

o) Obtenga información “en tiempo real” sobre las conexiones de su máquina, así como del ancho de banda consumido en cada una de ellas. Establezca un sistema de accounting del subsistema de red de su máquina de laboratorio.

p) Seleccione alguna máquina de laboratorio de cualquier compañero de clase como objetivo y, pensando en una DoS de tipo direct attack, haga las pruebas que estime oportunas. Repita la jugada pero pesando en una DoS de tipo reflective flooding attack. Trate de visualizar en todo momento las conexiones y, o, paquetería generada.

Para hacer el ataque directo utilice el plugin de ettercap y visualice los paquetes con el wireshark, comprobando que el ataque consiste en:
		1- Preguntar quien tiene la ip a atacar
		2- Respuesta de la victima
		3- Paquetes a todos los puertos de la victima, hasta sobrecargarla y tirarla

q) Considerando que todos los sistemas del laboratorio tiene autoconfiguración de la pila IPv6, ¿cómo podría tratar de tirar abajo todos los sistemas? Haga también pruebas de flooding en IPv6. ¿Cómo podríamos protegernos?.

	Con un ataque de flooding, llenando su pila y dejandolos KO.
	Podriamos protegernos de esto llevando un control de la pila o limitando numero de conexiones.

r) Ataque un servidor apache para provocarle un DoS. ¿Cómo podría proteger dicho servicio ante este tipo de ataque? ¿Y si se produce desde fuera de su segmento de red? ¿Cómo podría tratar de saltarse dicha protección? 